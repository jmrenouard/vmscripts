DEFAULT_PASSWORD="secret"
GLOBAL_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAyyq1cRvGmcM8VhEtz0dKg/jgHEgel/M5YafKBhz00ALtLBzy
BqaXUhvJGRlybMyQetbQ1GtrxHhKgendvXpxJ+13O5D62TqwfrdTDF+VTAErwyhJ
HyyzJMuslR/suOz4tIN8kMgFJ3Nml0dxHrsBmDglIWtm428R0NM6wYd8D1XXw2gt
AN4TSmHxv86jKZQxT6qBGMH4ODjKlNMGkSuZfo4tKX+i6/FltZC2Y7A///Sr7zuS
ngFtiC1BMrK4qFy3sKI54TtAWpQuENSzOMOKlLGCKhJ5mMbLiQYb6ed1aUoiykZO
JpTGIQt7vRGak4lpzst4LnTXCv27Wy2aUEQGHwIDAQABAoIBAEaFAI3OMlVU6zCE
rf3wpPDCBihK8DOV/SjkcL9GdcNuAJz7PxcH5CZf9qF7r7gMGWpJ/hp9Xt7HUjVd
09XdFkHhry1B2ZBlSrXxNCZrVwsWrPYEmbz0awoumCz689QMjRc7PJWUmBVlfQqt
hZpBFwCbHGhJO2FeQDTX3OEoAevgJStKPScKSwMKnZOFEEFuCSSapMFkvGlDhRfz
1kh6adUGgs/Gx9OQ0FGNfij84Jv/HnA2lDWP8Q9N1cOrOMsMpE0bT+2+30iZbIl7
H9NUvdFOe0UleGA5vofHkuE7sBHhzRuH+sO31QRGa/AHsbAu1oo0yIFdqDfnnxOg
UEj7WYECgYEA+FFjbLXQ1oC2Hy0FfGZEqAta68Pc7PnIM0JOeZeP+zp+4GB09CSa
di1OmusvLk0uOK+HE/JbL+ZazLykmDjxB7/Zl3e+qTaZQ6mKy7VVOE2WpA2FyAeP
YQmQ9uE7LhvqeOPcorYcQmVdgUx+EDLwxbyfTorhYE4oRpJdjaXyuTECgYEA0XO8
XLSpuzhBLNlt9CNYx8NM6YJXz806XdgclgT9I73SQvJB66hRLNDkWCr/0DEXFu5C
9l0YurEvQ4NS0HaP13GqdncvScQLmnggyn8DWlt+TJUXXhcoNwdVg6VuXkmGv34C
yOHsmZBtMwp8kEaSWmovMXKHyYCmj+RS3Sjy4E8CgYEAmPIYWScLgHM6ua0TSfH7
q72CvOCgvN2Er/3RNBdkOYtoBm+i2ZWKBewWFFlzcANdytBiVKjb/X7WwnAWuSOp
YeqK7T52EudsMz7EHICOAuXXOSiTFAeECnLH9Sf5OYc8PkWq6hVdBpBErZUduICH
yGNLhCcKdjTtnbodIVfrTqECgYBhsYHiG8IvOQXtTV0jynjWdBmjsNAUdL0MmIh8
0MbhrOAtqaFlsZRrOuPG3AeFq+ABKhDBqJqoOYy6CL7PzP06mCHSL7U2yuI+ollp
GeUOeC5ougG0OUjgoeMZDEh2YgUfvD7AQ+B/oAXPEM0Y3lHVKkHo5mq/aepGo1Cj
Jz5hsQKBgQDFiopBWw+E4ofKcgHNmje3Df2dHZCe/Fwt+IX6EVvtNuijtd4OiNRX
pzpFT2fBgVMVUJ6ZRxG+VluAu5wcL6ccdnfUhUJHWz290I3/eGyPzBeNzg5S1BGk
yqsjogJ7BGNuBebpOiZ63ASUH9QvEHC8uJV4FtRhsBJlWB5zs/UAIA==
-----END RSA PRIVATE KEY-----"

GLOBAL_PUBLIC_KEY="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDLKrVxG8aZwzxWES3PR0qD+OAcSB6X8zlhp8oGHPTQAu0sHPIGppdSG8kZGXJszJB61tDUa2vEeEqB6d29enEn7Xc7kPrZOrB+t1MMX5VMASvDKEkfLLMky6yVH+y47Pi0g3yQyAUnc2aXR3EeuwGYOCUha2bjbxHQ0zrBh3wPVdfDaC0A3hNKYfG/zqMplDFPqoEYwfg4OMqU0waRK5l+ji0pf6Lr8WW1kLZjsD//9KvvO5KeAW2ILUEysrioXLewojnhO0BalC4Q1LM4w4qUsYIqEnmYxsuJBhvp53VpSiLKRk4mlMYhC3u9EZqTiWnOy3gudNcK/btbLZpQRAYf vagrant@c7cassa3"

PUBLIC_AUTHORIZED_KEYS="ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDIS1Vif1rnAV+w5outuLTQTzUbGwvFkoR2g0S6hagJDgKr1UEazS6QedfOghnK3Y83GHRzT4bGRDHuKIWqJfzWpoJrAVhfXD/KGBiQzgu1R7J5WAbEvcyj0B6lHkvEfDZSDVj3TFUnKfqFwH8rHhq+fk98IzWSULp0N3f9PjWAKD2ANaTd3stTrlguWACYuR4ez9bCdS7w8X94XxjoVNAxb29qBgCH/DRvmsT2mjoAv5VUlWJliYVPyCYcqSWdlMe8p9YKuqu+OASwiew59uttjBNSRqjv2Rr1/624o5LQDeZfhnQdGJ18nGs20v3NSGZubDtn4AL2OkvB4VS8guXAtl1Dj1xmzbndO3twxBNa9AiYbBK/YOhhvK9vkiKuS6gF5NyKj+5bPj7/fLOefQfyvM2Hxfpmz7XPWIr1bkkRHm3D4nOujMMq+xRFKUwe42kbUL8FGVWItSrVnJCq/7RRyqyhzOm4VuHp1YZrhg66E6KZRPuz+Ifh/jpQ2MUTIzU=
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDwYsQzPrFALGuVyfQEm0UOden3lV3n83KZJyuSJzzt/UqqFYPNXdIRLSqjANN17vntsFPviFHGr2MnS0ipR5NVd9ESk1lsZ/MkSwVwmTp3D9Q+EdHaalLsNVHj/tTiHu/lWEH8JXNyLB6nqLjirHZxLgYGVGBEFk6XgC0Sb1Cetc6Y6VS0uBUKlWo6rOtCYJIjqLth/D/1QXM/wPWkrcMCnHAEXEDJYuCP98pDf75tVhOmWuzKNPtdFTgFean/ig6YRJCN6EN1NwWUZU7AN7ejZV1LeubgI+CQiOee06DUO8xbEe9yUYBFM91y45dKyHrLJkmvkpyGfyeSfWGHoUCt jmren@DESKTOP-JPKE7F3
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDJPKACA1l2Yz+5HFSiY7FWTxNiH5YdqzNLvaPfDMUG0GusfjSV89t1XWxOMoVnNCm2S0pyC1B67SWRNxrQ1Vv4nbkYIM6nVV8BR2ScfCzvFHT6nxbQ/uVocIpJ7hFRPvce/hm/7TkFJfk+NLWZlUJ/qbiwqhzTD32sZA1bWjNXiRw9315hc/bCKNyT87F94YQCbD3dXJds1q3RdKNXXbI76bo5q/kxrzLSiqj9lxTNui95PKf3IUSnR3fBXhvUzVPPuB2fYCawNziqhlrBL55Iz35tB4ejll/UuyUb+j+mw7C+n6ZNNOfomS2Fe7iBW1iArirnHK0RNGlvbfnFT7oV root@DESKTOP-JPKE7F3
$GLOBAL_PUBLIC_KEY"



echo '---------------------------------------------------'
echo "1° Setup default password"
echo '---------------------------------------------------'
#echo "$DEFAULT_PASSWORD" | sudo passwd --stdin root
#echo "$DEFAULT_PASSWORD" | sudo passwd --stdin vagrant

echo '---------------------------------------------------'
echo "2° Setup private ssh key for $(whoami) user"
echo '---------------------------------------------------'
echo "$GLOBAL_PRIVATE_KEY">/home/vagrant/.ssh/id_rsa
chmod 600 /home/vagrant/.ssh/id_rsa
chown vagrant. /home/vagrant/.ssh/id_rsa

echo '---------------------------------------------------'
echo "3° Setup public ssh key for $(whoami) user"
echo '---------------------------------------------------'
echo "" > /home/vagrant/.ssh/id_rsa.pub
chmod 644 /home/vagrant/.ssh/id_rsa.pub
chown vagrant. /home/vagrant/.ssh/id_rsa.pub

echo '---------------------------------------------------'
echo "3° Setup authorized public ssh key for $(whoami) user"
echo '---------------------------------------------------'
echo "$PUBLIC_AUTHORIZED_KEYS" >> /home/vagrant/.ssh/authorized_keys

echo '---------------------------------------------------'
echo "4° Copy same credentials for root"
echo '---------------------------------------------------'
sudo cp -pr ~vagrant/.ssh /root
sudo chown -R root.root  /root/.ssh
sudo mkdir -p /var/tmp2
sudo chmod -R 777 /var/tmp2

#echo '---------------------------------------------------'
#echo "5° Install EPEL REPOSITORY"
#echo '---------------------------------------------------'
#ps -edf | grep '[y]um'| awk '{ print $2}' | xargs -n 10 sudo kill -9

#sudo dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm

echo '---------------------------------------------------'
echo "6° Install some utlities"
echo '---------------------------------------------------'
sudo apt -y install rsync lftp socat htop python3 time git telnet perl

echo '---------------------------------------------------'
echo "7° Change SSHD behaviour password authentication  and root connexion allowed"
echo '---------------------------------------------------'
sudo perl -i -pe 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
sudo perl -i -pe 's/#PasswordAuthentication yes/PasswordAuthentication yes/g' /etc/ssh/sshd_config

sudo perl -i -pe 's/PermitRootLogin no/PermitRootLogin yes/g' /etc/ssh/sshd_config
sudo perl -i -pe 's/#PermitRootLogin yes/PermitRootLogin yes/g' /etc/ssh/sshd_config

sudo perl -i -pe 's/PubkeyAuthentication no/PubkeyAuthentication yes/g' /etc/ssh/sshd_config
sudo perl -i -pe 's/#PubkeyAuthentication yes/PubkeyAuthentication yes/g' /etc/ssh/sshd_config
sudo systemctl reload sshd


echo '---------------------------------------------------'
echo "8° update distro"
echo '---------------------------------------------------'
sudo apt -y update || true
echo "">$HOME/.bash_history
echo "" | sudo tee /root/.bash_history

echo '---------------------------------------------------'
echo "9° Flagging provision"
echo '---------------------------------------------------'
echo -n "I am provisioning at $(date)" | sudo tee -a /etc/vagrant_provisioned_at

true
